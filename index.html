<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>메가스터디 러셀 챗봇</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
    }
    .app {
      width: 100%;
      max-width: 420px;
      background: #ffffff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.18);
      display: flex;
      flex-direction: column;
      height: 700px;
    }
    header {
      background: #0072ff;
      color: #ffffff;
      padding: 14px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }
    header h1 {
      font-size: 16px;
      font-weight: 700;
    }
    header span {
      font-size: 12px;
      opacity: 0.9;
    }
    .chat-area {
      flex: 1;
      padding: 12px 14px;
      overflow-y: auto;
      background: #f9fafb;
    }
    .msg {
      margin-bottom: 10px;
      display: flex;
      gap: 6px;
    }
    .msg-bot .bubble {
      background: #e5e7eb;
      color: #111827;
      border-radius: 14px;
      border-bottom-left-radius: 4px;
    }
    .bubble {
      font-size: 13px;
      padding: 9px 11px;
      line-height: 1.4;
      max-width: 85%;
      white-space: pre-line;
    }
    .link-list {
      margin-top: 6px;
      font-size: 12px;
    }
    .link-list a {
      color: #2563eb;
      text-decoration: none;
    }
    .link-list a:hover {
      text-decoration: underline;
    }
    .btn-area {
      border-top: 1px solid #e5e7eb;
      padding: 10px 10px 14px;
      background: #ffffff;
    }
    .btn-title {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 6px;
    }
    .btn-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .chip-btn {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 7px 12px;
      font-size: 12px;
      background: #ffffff;
      cursor: pointer;
    }
    .chip-btn.main {
      font-weight: 600;
    }
    .chip-btn:hover {
      background: #f3f4f6;
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <h1>메가스터디 러셀 챗봇</h1>
    <span>대치학원 안내</span>
  </header>

  <div class="chat-area" id="chat"></div>

  <div class="btn-area">
    <div class="btn-title" id="btn-title">원하시는 메뉴를 선택해 주세요.</div>
    <div class="btn-list" id="btn-list"></div>
  </div>
</div>

<script>
/* ===============================
   0) russel.json 로딩
   =============================== */
let COURSE_DATA = [];
let COURSE_LOADED = false;
let COURSE_LOAD_FAILED = false;

fetch("russel.json")
  .then(res => res.json())
  .then(data => {
    COURSE_DATA = Array.isArray(data) ? data : [];
    COURSE_LOADED = true;
  })
  .catch(() => COURSE_LOAD_FAILED = true);

const RECOMMEND_MENU_KEY = "성적별 수업 추천";
const SUBJECT_LIST = ["국어", "수학", "영어", "사회", "과학", "논술"];
const LEVEL_LIST = ["1~2등급", "2~3등급", "3~4등급"];

/* ===============================
   1) 메뉴 데이터
   =============================== */
const MENU_DATA = {
  "학원 이용 가이드": [
    {
      label: "학원 공지사항",
      desc: "최근 학원 공지 및 안내사항",
      url: "https://russeldc.megastudy.net/russel/info/notice/notice.asp"
    },
    {
      label: "오시는 길",
      desc: "러셀 대치학원 위치 안내",
      url: "https://russeldc.megastudy.net/russel/info/location.asp",
      botText:
        "러셀 대치학원 오시는 길 안내입니다.\n\n" +
        "• 대중교통(지하철/버스) 이용 경로\n" +
        "• 건물 위치 및 출입 안내\n" +
        "• 주차 및 하차 관련 안내\n\n" +
        "아래 링크에서 지도로 자세히 확인하실 수 있습니다."
    }
  ]
};

/* ===============================
   2) 공통 UI 함수
   =============================== */
const chat = document.getElementById("chat");
const btnList = document.getElementById("btn-list");
const btnTitle = document.getElementById("btn-title");

const MAIN_MENUS = [...Object.keys(MENU_DATA), RECOMMEND_MENU_KEY];

function addBotMessage(text, linksHtml = "") {
  const wrap = document.createElement("div");
  wrap.className = "msg msg-bot";

  const bubble = document.createElement("div");
  bubble.className = "bubble";
  bubble.textContent = text;
  wrap.appendChild(bubble);

  if (linksHtml) {
    const box = document.createElement("div");
    box.className = "link-list";
    box.innerHTML = linksHtml;
    bubble.appendChild(document.createElement("br"));
    bubble.appendChild(box);
  }

  chat.appendChild(wrap);
  chat.scrollTop = chat.scrollHeight;
}

function renderMainButtons() {
  btnTitle.textContent = "원하시는 메뉴를 선택해 주세요.";
  btnList.innerHTML = "";
  MAIN_MENUS.forEach(menu => {
    const btn = document.createElement("button");
    btn.className = "chip-btn main";
    btn.textContent = menu;
    btn.onclick = () => {
      if (menu === RECOMMEND_MENU_KEY) openRecommendFlow();
      else openMenu(menu);
    };
    btnList.appendChild(btn);
  });
}

function openMenu(menuName) {
  const items = MENU_DATA[menuName];
  if (!items) return;

  addBotMessage(`『${menuName}』 안내입니다.`);
  btnTitle.textContent = `${menuName} 세부 메뉴`;
  btnList.innerHTML = "";

  items.forEach(item => {
    const btn = document.createElement("button");
    btn.className = "chip-btn";
    btn.textContent = item.label;

    btn.onclick = () => {
      if (item.label === "오시는 길") {
        addBotMessage(
          item.botText,
          `홈페이지에서 자세히 확인하겠습니까?\n<a href="${item.url}" target="_blank">오시는 길 페이지 열기</a>`
        );
      } else {
        addBotMessage(
          `${item.label} 페이지로 이동합니다.`,
          `<a href="${item.url}" target="_blank">${item.label} 바로가기</a>`
        );
        window.open(item.url, "_blank");
      }
    };

    btnList.appendChild(btn);
  });

  const homeBtn = document.createElement("button");
  homeBtn.className = "chip-btn";
  homeBtn.textContent = "◀ 처음으로";
  homeBtn.onclick = renderMainButtons;
  btnList.appendChild(homeBtn);
}

/* ===============================
   3) 성적별 수업 추천
   =============================== */
function openRecommendFlow() {
  addBotMessage("성적별 수업 추천입니다.\n과목을 선택해주세요.");
  btnTitle.textContent = "과목 선택";
  btnList.innerHTML = "";

  SUBJECT_LIST.forEach(sub => {
    const btn = document.createElement("button");
    btn.className = "chip-btn";
    btn.textContent = sub;
    btn.onclick = () => renderLevel(sub);
    btnList.appendChild(btn);
  });
}

function renderLevel(subject) {
  btnTitle.textContent = `${subject} / 등급 선택`;
  btnList.innerHTML = "";

  LEVEL_LIST.forEach(lv => {
    const btn = document.createElement("button");
    btn.className = "chip-btn";
    btn.textContent = lv;
    btn.onclick = () => showRecommend(subject, lv);
    btnList.appendChild(btn);
  });
}

function showRecommend(subject, level) {
  const list = COURSE_DATA.filter(
    c => c.subject === subject && c.level_text === level
  );

  let msg = `『${subject} / ${level}』 추천 수업\n\n`;
  if (list.length === 0) msg += "해당 조건의 강좌가 없습니다.";
  else {
    list.forEach((c, i) => {
      msg += `${i + 1}. ${c.title} - ${c.teacher}\n`;
      msg += `   ${c.day} / ${c.time_raw}\n\n`;
    });
  }

  addBotMessage(msg.trim());
  renderMainButtons();
}

/* ===============================
   4) 초기 실행
   =============================== */
addBotMessage(
  "안녕하세요. 메가스터디 러셀 대치학원 챗봇입니다.\n\n" +
  "학원 이용 안내와 성적별 수업 추천을 제공합니다.\n" +
  "아래 메뉴를 선택해주세요."
);
renderMainButtons();
</script>
</body>
</html>
